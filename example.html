<html>
<head>

  <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

  <style>    
    span.json {

  font-family: monospace;
    }
    
    span.json div {
      margin-left: 18px;
      display:none;
    }
    
    td.server_response{
      padding:6px; background-color: #ECECEC; color: #007777;
    }
    
    span.json span.key {
      color: #CC0000;
      font-weight: bold;
    }

    span.expand_or_collapse:hover {
      cursor: pointer;
    }
    
    span.expand_or_collapse {
      font-weight: bold;
      color: black;
    }
    
    span.expand_or_collapse img {
      position: relative;
      top: 2px;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <table>
    <colgroup>
    <col />
    <col />
    <col />
    <col style="width: 1000px;"/>
    </colgroup>
    <tr>
    <th>one</th>
    <th>two</th>
    <th>three</th>
    <th>json</th>
    </tr>
    <tr>
    <td>1</td>
    <td>2</td>
    <td>3</td>
    <td class="server_response">
    <br />
    <span class="json">{ "glos:  sary": { "title": "example:  glossary1", "Gloss{Div": { "title": "S", "GlossList": { "GlossEntry": { "ID": "SGML", "SortAs": "SGML", "GlossTerm": "Standard Generalized Markup Language", "Acronym": "SGML", "Abbrev": "ISO 8879:1986", "GlossDef": { "para": "A meta-markup language, used to create markup languages such as DocBook.", "GlossSeeAlso": ["GML", "XML"] }, "GlossSee": "markup" } } } } }</span>
    <div id='Canvas' class="Canvas">
    </div>
    </td>
    </tr><!-- <tr>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td class="server_response">
        <br />
        <span class="json">{ "glossary": { "title": "example glossary2", "GlossDiv": { "title": "S", "GlossList": { "GlossEntry": { "ID": "SGML", "SortAs": "SGML", "GlossTerm": "Standard Generalized Markup Language", "Acronym": "SGML", "Abbrev": "ISO 8879:1986", "GlossDef": { "para": "A meta-markup language, used to create markup languages such as DocBook.", "GlossSeeAlso": ["GML", "XML"] }, "GlossSee": "markup" } } } } }</span>
        <div id='Canvas' class="Canvas">
        </div>
        </td>
        </tr><tr>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td class="server_response">
        <br />
        <span class="json">{ "glossary": { "title": "example glossary3", "GlossDiv": { "title": "S", "GlossList": { "GlossEntry": { "ID": "SGML", "SortAs": "SGML", "GlossTerm": "Standard Generalized Markup Language", "Acronym": "SGML", "Abbrev": "ISO 8879:1986", "GlossDef": { "para": "A meta-markup language, used to create markup languages such as DocBook.", "GlossSeeAlso": ["GML", "XML"] }, "GlossSee": "markup" } } } } }</span>
        <div id='Canvas' class="Canvas">
        </div>
        </td>
        </tr><tr>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td class="server_response">
        <br />
        <span class="json">{ "glossary": { "title": "example glossary4", "GlossDiv": { "title": "S", "GlossList": { "GlossEntry": { "ID": "SGML", "SortAs": "SGML", "GlossTerm": "Standard Generalized Markup Language", "Acronym": "SGML", "Abbrev": "ISO 8879:1986", "GlossDef": { "para": "A meta-markup language, used to create markup languages such as DocBook.", "GlossSeeAlso": ["GML", "XML"] }, "GlossSee": "markup" } } } } }</span>
        <div id='Canvas' class="Canvas">
        </div>
        </td>
        </tr><tr>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td class="server_response">
        <br />
        <span class="json">{ "glossary": { "title": "example glossary5", "GlossDiv": { "title": "S", "GlossList": { "GlossEntry": { "ID": "SGML", "SortAs": "SGML", "GlossTerm": "Standard Generalized Markup Language", "Acronym": "SGML", "Abbrev": "ISO 8879:1986", "GlossDef": { "para": "A meta-markup language, used to create markup languages such as DocBook.", "GlossSeeAlso": ["GML", "XML"] }, "GlossSee": "markup" } } } } }</span>
        <div id='Canvas' class="Canvas">
        </div>
        </td>
        </tr> -->
  </table>
</body>
<foot>
  <script>
  $(function() {
    $('.expand_or_collapse img').live('click', function(){
      var self = $(this).parents('.expand_or_collapse')
      console.log(self.next('div'))
      self.next('div').toggle();
      if(self.hasClass('collapsed')){
        self.html(image_expanded());
        self.removeClass('collapsed')
      } else {
        self.addClass('collapsed')
        self.html(image_collapsed());
      }
    })

  
  function image_collapsed(){
    return '<img src="images/collapsed.gif" />';
  }
  
  function image_expanded(){
    return '<img src="images/expanded.gif" />';    
  }

  function build_collapsed(){
     return '<span class="expand_or_collapse collapsed">' + image_collapsed() + '</span>';
  }
  
  function wrap_key(key_name){
    return '<span class="key">"' + key_name + '"</span>';
  }

  function add_wrapped_key(attribute){
    html += wrap_key(attribute) + ' : ';
  }
  
  function add_line_break(){
    html += ',<br />';
  }
  
  function process_string_node(node, attribute, keyed){
    if(keyed){
      add_wrapped_key(attribute);
    }
    
    html += '"' + node[attribute] + '"';    
  }

  function process_non_quoted_type(node, attribute, keyed){
    if(keyed){
      add_wrapped_key(attribute);
    }
    
    html += node[attribute]    
  }
  
  function process_number_node(node, attribute, keyed){
    process_non_quoted_type(node, attribute, keyed);
  }

  function process_boolean_node(node, attribute, keyed){
    process_non_quoted_type(node, attribute, keyed);
  }

  function process_null_node(node, attribute, keyed){
    if(keyed){
      add_wrapped_key(attribute);      
    }
    
    html += 'null';
  }
  
  function process_object_node(node, attribute, keyed){
    if(keyed){
      add_wrapped_key(attribute);
    }
    
    process_node(node[attribute])
  }
  
  function process_array_node(node){
    html += "[" + build_collapsed() + '<div>'
  
    for(attribute in node){
      eval('process_' + typeof(node[attribute]) + '_node').call(this, node, attribute, false);
      if(node.indexOf(attribute) + 1 != node.length){
        add_line_break();
      }
    }
    html += '</div> ]'    
  }
  
  html = "";
  function process_node(node){
    if(node instanceof Array){
      process_array_node(node);
    } else if(node === null){
      process_null_node(node);
    } else {
      html += "{" + build_collapsed() + '<div>'
      var node_length = 0;
      for(attribute in node){
        node_length += 1;
      }
    
      var iteration = 0
      for(attribute in node){
        iteration += 1
        eval('process_' + typeof(node[attribute]) + '_node').call(this, node, attribute, true);
        if(iteration != node_length){
          add_line_break();
        }
      }
      html += '</div> }'
    }
  }
  
   function present_json(element){
     var self = $(element)
     console.log(self)
     console.log(self.html())
     parsed_json = $.parseJSON(self.html());     
     
     process_node(parsed_json);
     self.html(html)
   }

   $('.json').each(function(index, element){
     present_json(element)
   })   
  });
  </script>
</foot>
</html>